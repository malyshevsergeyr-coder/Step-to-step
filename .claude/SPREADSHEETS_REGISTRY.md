# Реестр Google Таблиц ТМК

## Подключение
- **MCP-сервер:** mcp-google-sheets (через Service Account)
- **Service Account:** claude-mcp@tmk-corporation.iam.gserviceaccount.com
- **Ключ:** C:\Users\office\Documents\Google Web\tmk-corporation-b846b9cbd25b.json
- **Google Cloud Project:** tmk-corporation
- **Email владельца:** malyshev.sergey.r@gmail.com

---

## 1. Основная таблица веб-приложения

**Название:** Новая таблица
**ID:** `1myrm7Pya1eeesh_qQDk1IyMYtrKZkXUOgiKp8lW-b-A`
**Назначение:** Бэкенд-хранилище для Google Apps Script веб-приложения (Code.js + Index.html)
**Apps Script Project:** https://script.google.com/ (clasp push из локальной папки)

### Листы:
| Лист | Колонки | Назначение |
|------|---------|------------|
| `users` | user_id, login, password_plain, password_hash, salt, name, role, area, is_active, created_at, last_login_at, **stage_code** | Пользователи системы. Роли: Администратор, Начальник, (Рабочий — планируется). **stage_code** — привязка оператора к этапу (РАСКРОЙ, ЗАКАЛКА и т.д.) |
| `order` | id_product, direction, process, width, height, quantity, formula, print, sticker, manual, allowance | Заказы на раскрой (форма ввода) |
| `sessions` | token, user_id, created_at, expires_at, last_seen_at, revoked | Сессии авторизации |
| `cutting_orders` | order_id, created_at, created_by_user_id, created_by_name, menu_title, status, id_product, direction, process, width_mm, height_mm, quantity, formula, print, sticker, manual, allowance_mm, updated_at, updated_by_user_id | Задания на раскрой |
| `notifications` | notification_id, to_user_id, to_role, title, message, related_order_id, created_at, read_at, deleted | Уведомления |
| `chat_messages` | message_id, thread_key, from_user_id, to_user_id, text, attachment_url, attachment_name, attachment_type, created_at, read_at, deleted | Чат (пока пустой) |
| `disks` | disk_id, disk_number, disk_date, order_number, customer, formula, total_items, current_stage, route, created_at, created_by, status | **ПРОТОТИП:** Дискеты (заказы на обработку) |
| `disk_items` | item_id, disk_id, position, glass_1, spacer, glass_2, glass_3, spacer_2, width_mm, height_mm, quantity, area_m2, current_stage, current_status | **ПРОТОТИП:** Изделия в дискете |
| `stage_log` | log_id, item_id, disk_id, stage, status, operator_id, operator_name, started_at, completed_at, defect_type, defect_cause, comment | **ПРОТОТИП:** Журнал прохождения этапов |
| `stages_config` | stage_code, stage_name, order_index, condition, is_active | **ПРОТОТИП:** Справочник этапов (7 шт) |
| `operators` | operator_id, name, post, stage_code, phone, is_active | **ПРОТОТИП:** Операторы производства |

### Текущие данные:
- 2 пользователя: test (Администратор), cut1/Алёна (Начальник)
- 1 задание на раскрой (тестовое)
- 1 уведомление
- **ПРОТОТИП:** 2 тестовые дискеты, 7 этапов, 2 оператора

---

## 2. Табель рабочего времени (Gate/SoftGate)

**Название:** Отчёт посещаемости
**ID:** `1yF9iuHcFaTyJ2X6PntO7661HFukmSgQWydhZsukHsC8`
**Назначение:** Учёт рабочего времени сотрудников на основе данных СКУД Gate
**Статус:** Базовый функционал готов, февраль — тестовый режим
**Периодичность:** Раз в месяц

### Листы:
| Лист | Назначение | Виден |
|------|------------|-------|
| `Sheet1` | Сырые данные из Gate (копипаст Excel) | Скрыт |
| `gate_raw` | Резервный (не используется) | Скрыт |
| `gate_events` | Плоская таблица событий (парсинг) | ✅ Да |
| `табель` | Сводка ФИО × Дни месяца | ✅ Да |
| `детали` | Для drill-down (будущее) | Скрыт |

### Структура gate_events:
| Колонка | Описание |
|---------|----------|
| ФИО | Полное имя сотрудника |
| Ключ | Номер ключа СКУД |
| Дата | DD.MM.YYYY |
| Время входа | HH:MM |
| Время выхода | HH:MM |
| Минут | Отработано минут |
| Часов | Отработано H:MM |
| Тип | полный / вход / выход |

### Структура табель:
- Строки: ФИО сотрудников (сортировка по алфавиту)
- Колонки: Дни месяца (DD.MM) + ИТОГО
- Ячейки: Отработанные часы (H:MM)
- Цветовая шкала: 8+ зелёный, 6-7 светло-зелёный, 4-5 жёлтый, 1-3 оранжевый

### Функции Code.js:
- `parseGateData()` — парсинг Sheet1 → gate_events
- `buildTimesheet()` — построение табеля
- `formatTimesheetTables()` — профессиональное оформление
- `processGateAndBuildTimesheet()` — полный цикл

---

## 3. Движение заказа (МАКЕТ)

**Название:** Движение заказа
**ID:** `17IER5U5t3wAgoIFuLqhF21_AGPNprqEus0yceDWIHhY`
**Назначение:** Макет будущей системы отслеживания заказов в производстве через QR-коды. Спроектирован Сергеем.

### Листы:
| Лист | Назначение |
|------|------------|
| `Заказы` | Основная таблица: ID_изделия, Номер_заказа, Код_изделия, Маршрут_производства, Текущий_статус (В работе/Раскрой/Кромка/Закалка/.../Готово), Следующий_этап. Статус "Готово" обновляет таблицу "Планирование производства" |
| `Справочник_изделий` | Каталог типов стеклопакетов. Пример: IGU_01 = "6зак × 4Ар × 4зак". Флаги: закалка, кромка, покраска, плёнка, аргон, тип рамки |
| `Этапы_производства` | Маршрутная карта: РАСКРОЙ (всегда) → КРОМКА (если нужна) → ЗАКАЛКА (если нужна) → ПОКРАСКА → ПЛЁНКА → РАМКА (если аргон) → СБОРКА (всегда) |
| `Журнал_сканирования` | Лог QR-сканирований: дата, ID_изделия, этап, оператор, пост, результат |
| `Операторы_и_посты` | Справочник: код_оператора, имя, производственный_пост, код_этапа |
| `QR_коды` | Генерация QR: ID_изделия → ссылка → QR-код → дата создания |

### Ключевая логика:
- Маршрут рассчитывается автоматически из справочника изделий
- Каждое изделие получает QR-код
- Оператор сканирует QR на каждом этапе
- Система автоматически обновляет статус

---

## 4. Учёт брака

**Название:** (конвертирована из Excel)
**ID:** `19Ys3iyepFMDcYWg9o8m9Zy2UDPbu7zjOOq66xKFt0JI`
**Назначение:** Фиксация брака на производстве, помесячно

### Листы:
- ` январь 2026` (с пробелом в начале!)
- `февраль 2026`

### Колонки:
дата, №заказа/дискеты, стекло (марка), длина, ширина, кол-во, площадь (формула), стоимость, вид брака, причина брака, участок, лицо, комментарии

### Виды брака:
стёрто покрытие, разбилось в чиллере, разбилось при перевозке, лопнул СП, микротрещина, не в размер, царапина, капли краски

### Причины:
человеческий фактор, некорректная работа оборудования

### Участки:
б.печь (большая печь), сп (стеклопакеты), CMS

### Справа — сводка:
Итого площадь и ущерб по маркам стекла (4.1.4, 4И, 4Изак, 4М1, 4зак, 5м1, 6 StandSTзак, 6PlGrey, и т.д.)

---

## 5. Сменное задание

**Название:** Сменное задание
**ID:** `1NgmBLhsQ4joq-UyOFqOzSxMRfYf_cuPS9IOY0Rr-jA8`
**Назначение:** Понедельное планирование раскроя стекла по 3 постам

### Структура (22 листа):
- Листы по неделям: `10.09.-`, `с 15.09.`, `Планирование`, `06.10-12.10`, ..., `02.02-08.02`, `09.02-15.02`, ..., `23.02-01.03`
- Лист `Форма` — шаблон для новых недель

### 3 поста раскроя:
| Пост | Ворота | Станок | Специализация |
|------|--------|--------|---------------|
| РАСКРОЙ 1 | 6 ворота | Китаец | + 10 mm стекло |
| РАСКРОЙ 2 | 9 ворота | Лисик 2 | + макс 10 mm + снятие покрытия |
| РАСКРОЙ 3 | 5 ворота | Лисик 1 | + триплекс 4.2.4 + max 10 mm |

### Колонки на каждый пост:
ОЧЕРЕДЬ, Номер заказа/клиент, Дискета №/ДАТА, формула стеклопакета/марка стекла, кол-во изделий, кол-во стекол (ПЛАН), площадь изделий, условная площадь, кол-во стекол (ФАКТ), Примечание

### Особенности:
- День/Ночь смены
- Инструкция по фиксации брака в примечаниях
- Поименованные диапазоны для участков с нормами
- Важно: "ПЕРЕД НАЧАЛОМ СМЕНЫ ОБНОВИТЬ СТРАНИЦУ"

---

## 6. Планирование производства

**Название:** Планирование производства
**ID:** `1ywI1QDi5kIL62xOIeP69m_ABsykaKzgjYGuBXigB9MY`
**Назначение:** Полный цикл управления заказами на производстве

### Листы:
| Лист | Назначение |
|------|------------|
| `План.2026` | Сводный: заказчик, номер заказа, дата погрузки, дискета, дата сборки план/факт, статус |
| `План производства.2026` | Детальный (35+ колонок): заказчик, номер заказа, цех, дата погрузки, кол-во изделий, примечания, статус для клиентов, дискета, формула, кол-во стёкол, площадь, условная площадь, тип сложности, дата сборки план/факт + до 5 НОМИНАЛОВ стёкол с их статусами и датами |
| `Сортировка` | Фильтрация по статусам и датам |
| `Справочник` | Типы сложности с коэффициентами условной площади |
| `Загрузка` | Понедельный план/факт в м.кв. по месяцам (дек 2025 — мар 2026) |

### Статусы заказов (для клиентов):
Не запущен → Запущен в производство → Запланирован на сборку → Выполнен на производстве → Выполнен частично → Приостановлен → Отменен

### Коэффициенты условной площади:
| Тип | Коэф. |
|-----|-------|
| Простые стеклопакеты | 1.3 |
| СПО фигура | 2.6 |
| СПД фигура | 2.6 |
| СПО "теплый край" | 2.83 |
| СПД "теплый край" | 3.68 |
| СПО со шпросами | 2.72 |
| СПД со шпросами | 4.01 |

---

## 7. Планирование СП

**Название:** Планирование СП
**ID:** `16rsin2q9kYBG8EWH9zCPpxrwIPDCLFBeGJXelRE2Q9A`
**Назначение:** Планирование заказов стеклопакетов — от продажи до отгрузки

### Листы:
| Лист | Назначение |
|------|------------|
| `Планирование СП.2026` | Основной: заказ, кол-во, заказчик, упаковка, дата погрузки, менеджер, дискета, цех, статус выполнения, статус отгрузки, кладовщик |
| `Планирование СП.2025` | Архив прошлого года |
| `Справочник СП.2026` | Виды упаковки + контакты менеджеров |
| `Регистрация 444` | Реестр номеров заказов по контрагентам (АРТСТЕК, МАСТЕРПЛАСТ и др.) |
| `Лист1` | Задачи/статусы (шаблон) |
| `Лист3` | Функции/категории (шаблон) |
| `Лист4` | Вспомогательный |

### Виды упаковки:
Тара (Ящик), Тара (Пирамида), Пирамида Дер, Пирамида Мет, Самовывоз, Перемещение

### Ключевые менеджеры:
- Григорьева Наталия Юрьевна (89301817828)
- Голубева Светлана Юрьевна (89301683757)
- Котова Антонина Алексеевна (89290964367)
- Куземов Дмитрий Валерьевич (89290960210)
- Лейман Юлия Владимировна (89301817828/89301550171)
- Орлова Елена Михайловна (89301741951)

### Связь с другими таблицами:
- Колонка "СТАТУС выполнения заказа на производстве" импортируется из "Планирование производства" (План производства.2026)
- Данные заполняются: отдел продаж → плановый отдел СП → склад ГП СП

---

## 8. Отчёт посещаемости (оригинальный)

**Название:** Отчет посещаемости 01.02.2026 - 04.02.2026
**ID:** `1t8hnza6k99mqp1qlsoNKcB7gn-0xT7GhVFeisrjHLvQ`
**Примечание:** Это оригинальный экспорт из Gate. Новый табель (#2) использует другую таблицу.
**Назначение:** Контроль входа/выхода сотрудников по СКУД

### Структура:
- ФИО сотрудника, номер ключа
- Устройство входа/выхода (название турникета), дата, время
- Итого времени

### Пример:
Малышев Сергей Романович, ключ 254/18536, "стеколка 2 вход" → "стеколка 2 выход", итого 0:10

---

## 10. Учёт стекла (складской учёт)

**Название:** Учёт стекла
**ID:** `1Xp7RCA4wnaa7aef2fqvQIQhk-oWxhKoZebkLY1mkHqA`
**Назначение:** Складской учёт сырьевого стекла по локациям (цехам/воротам)
**Оригинал:** Конвертирован из Excel

### Листы:
| Лист | Назначение |
|------|------------|
| `Учет` | Ежедневный учёт остатков (ФАКТ → Приход → Расход → Остаток) |
| `1 кв. 2026` | Учёт за квартал + стоимость в рублях |
| `Справочник стекла` | Номенклатура: толщина, тип, производитель, цена за м² |
| `Расчет стекла для заказа` | Калькулятор: листы → пачки → машина (вес, площадь) |
| `Форма` | Пустой шаблон для ежедневного заполнения |

### Локации (склады):
| Цех | Ворота | Ответственный |
|-----|--------|---------------|
| Цех №2 | 5 ворота | Кропочева Е. |
| Цех №2 | 6 ворота | Кропочева Е. |
| Цех №3 | 9 ворота | Каюмова Е. |
| Цех №1 | Нестандарт | Скворцов М. |

### Форматы тары:
| Формат | Размер (м) | Площадь листа (м²) |
|--------|------------|-------------------|
| Джамба | 6.00 × 3.21 | 19.26 |
| Ящик 1 | 3.21 × 2.25 | 7.22 |
| Ящик 2 | 2.55 × 1.605 | 4.09 |
| Ящик 3 | 4.50 × 3.21 | 14.45 |
| Евро | 2.25 × 1.60 | 3.60 |

### Потенциал автоматизации:
- Автосписание стекла при раскрое дискеты
- Уведомления о критических остатках
- Расчёт себестоимости заказа

---

## 11. Штатная расстановка (1С)

**Название:** Штатная расстановка
**ID:** `1IfFJYPEZEqWXfDAma7WHp74pvi515SaUEkoo_UqqZrY`
**Назначение:** Выгрузка списка сотрудников из 1С:УПП
**Источник:** Отчёт "Штатная расстановка" с фильтром по стекольному производству

### Структура:
- Подразделение → Должность → ФИО → Количество ставок
- Фильтр: "3. Стекольное производство"
- Всего: 126 сотрудников

### Использование:
- Сверка с данными Gate для табеля
- Выявление уволенных (есть в Gate, нет в штатной)
- Выявление новых без проходов (есть в штатной, нет в Gate)

---

## 12. СПРАВОЧНИК (мастер-таблица)

**Название:** СПРАВОЧНИК - Стекольное производство ТМК
**ID:** `14D-OArIClwsJQ585RgHk4LBeXqWV_5ukfNMAHnKLotQ`
**Назначение:** Централизованный справочник всей информации о производстве
**Ссылка:** https://docs.google.com/spreadsheets/d/14D-OArIClwsJQ585RgHk4LBeXqWV_5ukfNMAHnKLotQ

### Листы:
| Лист | Содержимое | Записей |
|------|------------|---------|
| ОГЛАВЛЕНИЕ | Навигация по справочнику | — |
| Номенклатура стекла | Все виды стекла (толщина, тип, цена) | 50+ |
| Виды тары | Форматы (Джамба, Ящик, Евро) | 5 |
| Локации и склады | Цехи, ворота, ответственные | 4 |
| Сотрудники | Штатная расстановка из 1С | 126 |
| Этапы производства | 7 этапов от раскроя до сборки | 7 |
| Производители | Поставщики стекла | 6 |
| Рабочие таблицы | Ссылки на все таблицы проекта | 5+ |

### Источники данных:
- Учёт стекла (справочник стекла, номенклатура)
- 1С:УПП (штатная расстановка)
- Документация проекта

---

## НЕ КОНВЕРТИРОВАННЫЕ ТАБЛИЦЫ (Excel на Google Drive)

Эти файлы — исходные Excel, которые Google Sheets API не может читать напрямую.
Конвертированные версии указаны выше.

| Исходный ID | Что это |
|-------------|---------|
| `1mo7abQzX7a3pFAvq3PZYmzXUYxBBl6jB` | Excel-оригинал (не определён) |
| `1lHFeeRxNpfvBb-fDIzG1Gtwrj1pmMTKT` | Excel-оригинал (не определён) |
| `1izMA5wHPm9whyT03NUsIhsgylamX1iaK` | Excel-оригинал Сменного задания |
| `1iqWGjkqKf6EWp-plfx94FqMdq4KM7_DT` | Excel-оригинал Планирования СП |
| `1WLqLskPNLozd7QgLJDSn0lbc13lx1nSW` | Excel-оригинал Отчёта посещаемости |

---

## СВЯЗИ МЕЖДУ ТАБЛИЦАМИ

```
Планирование СП.2026
    ↓ (статус заказа)
План производства.2026
    ↓ (дискеты, формулы)
Сменное задание (понедельно)
    ↓ (факт выполнения, брак)
Учёт брака (помесячно)

Движение заказа (МАКЕТ — будущая система)
    → заменит ручное обновление статусов
    → QR-сканирование на каждом этапе
    → автоматическое обновление "Планирование производства"
```

---

## Папки Google Drive

| Папка | Содержание |
|-------|------------|
| Управление заказами и производством | Планирование производства, Планирование СП |
| Таблицы себестоимости и брака | Учёт брака |
| Отчёты посещаемости | Отчёты СКУД по сотрудникам |
| appsheet | Шаблоны AppSheet Tracker (не нужны) |

---

## 9. Таблица с другого производства (эталон)

**Название:** (склад стекла другого производства)
**ID:** `1brK1eUYfj03OR86PqrgVOP72VmyB8VP-cbl5uI4j6u8`
**Назначение:** Эталон для заимствования удачных практик. Особенно хорош учёт склада.

### Листы:
| Лист | Назначение |
|------|------------|
| Калькулятор склад | Сводка: в наличии → размещено по проектам → дефицит → запланировано |
| Склад основной ESL | Учёт по кассетам: номер кассеты, марка, размеры, завод, кол-во листов, площадь |
| АТН | Второй склад, та же структура |
| Склад BSK | Третий склад |
| ДО ESLBSK | Дополнительный склад |
| Доставка стекла | История поставок: дата, номенклатура, формат (Джамбо), пачки, площадь, статусы |
| Заказанное стекло | Заказы поставщикам: марка, формат, объём, дата производства, завод (Ларта Рязань) |
| Осталось порезать стекла | Расчёт остатков для раскроя |
| Номенклатура стекла (выгрузка) | Справочник из 1С |

### Удачные практики для заимствования:
- Учёт по кассетам (адресное хранение)
- Калькулятор дефицита (в наличии - размещено = дефицит)
- Трекинг поставок (сформирован → подтверждён → выгружен)
- Разбивка по проектам

---

## Внешние ресурсы

### d-brain (GitHub-репозиторий Серёги)
- **URL:** https://github.com/malyshevsergeyr-coder/d-brain
- **Локальный клон:** C:\Users\office\Documents\d-brain
- **Что это:** Telegram-бот "второй мозг" (Python/aiogram)
- **Vault:** goals/, daily/, thoughts/, MOC/
- **Связь с Todoist:** через MCP (todoist-ai)
- **Использование:** читать daily записи для контекста, синхронизировать задачи

---

**Последнее обновление:** 2026-02-06
**Версия:** 1.4
